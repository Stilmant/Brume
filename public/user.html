<!doctype html>
<html>
<head>
  <meta charset='utf-8'/>
  <title>Brume - Assistant IA</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background-color: #343541;
      color: #ececf1;
      height: 100vh;
      display: flex;
      flex-direction: column;
    }
    .header {
      background: #202123;
      padding: 12px 20px;
      border-bottom: 1px solid #4d4d4f;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .header h1 {
      font-size: 18px;
      font-weight: 600;
      color: #ececf1;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .logo {
      width: 32px;
      height: 32px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 16px;
      color: white;
    }
    .session-id {
      font-size: 12px;
      color: #8e8ea0;
      background: #40414f;
      padding: 4px 10px;
      border-radius: 12px;
    }
    #chat {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    #chat::-webkit-scrollbar { width: 8px; }
    #chat::-webkit-scrollbar-track { background: #343541; }
    #chat::-webkit-scrollbar-thumb { background: #565869; border-radius: 4px; }
    .message { display: flex; gap: 16px; padding: 20px; max-width: 800px; margin: 0 auto; width: 100%; }
    .message.user { background: #343541; }
    .message.ai { background: #444654; }
    .avatar {
      width: 36px;
      height: 36px;
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      font-weight: 600;
      font-size: 14px;
    }
    .avatar.user { background: #5436da; color: white; }
    .avatar.ai { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
    .message-content { flex: 1; padding-top: 8px; line-height: 1.6; font-size: 15px; }
    .typing { display: flex; gap: 4px; padding: 8px 0; }
    .typing span {
      width: 8px;
      height: 8px;
      background: #8e8ea0;
      border-radius: 50%;
      animation: bounce 1.4s infinite ease-in-out;
    }
    .typing span:nth-child(1) { animation-delay: -0.32s; }
    .typing span:nth-child(2) { animation-delay: -0.16s; }
    @keyframes bounce {
      0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
      40% { transform: scale(1); opacity: 1; }
    }
    .input-container { padding: 20px; background: #343541; border-top: 1px solid #4d4d4f; }
    .input-wrapper { max-width: 800px; margin: 0 auto; position: relative; }
    #f { display: flex; align-items: center; background: #40414f; border-radius: 12px; padding: 12px 16px; }
    #q {
      flex: 1;
      background: transparent;
      border: none;
      color: #ececf1;
      font-size: 15px;
      outline: none;
      font-family: inherit;
      resize: none;
      max-height: 200px;
    }
    #q::placeholder { color: #8e8ea0; }
    button {
      background: #19c37d;
      color: white;
      border: none;
      padding: 10px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      transition: background 0.2s;
      margin-left: 12px;
    }
    button:hover { background: #1a9f6a; }
    button:disabled { background: #3f3f46; cursor: not-allowed; }
    .welcome { text-align: center; padding: 40px 20px; color: #8e8ea0; }
    .welcome h2 { font-size: 28px; color: #ececf1; margin-bottom: 12px; }
    .welcome p { font-size: 15px; }
  </style>
</head>
<body>
  <div class='header'>
    <h1><div class='logo'>B</div>Brume</h1>
    <div class='session-id' id='sessionId'></div>
  </div>
  <div id='chat'>
    <div class='welcome'>
      <h2>Bienvenue sur Brume</h2>
      <p>Votre assistant intelligent est prêt à répondre à vos questions.</p>
    </div>
  </div>
  <div class='input-container'>
    <div class='input-wrapper'>
      <form id='f'>
        <input id='q' placeholder='Envoyez un message à Brume...' autocomplete='off'/>
        <button type='submit'>Envoyer</button>
      </form>
    </div>
  </div>
  <script src='/socket.io/socket.io.js'></script>
  <script>
    const socket=io({query:{role:'user'}});
    const chat=document.getElementById('chat');
    const form=document.getElementById('f');
    const input=document.getElementById('q');
    const sessionIdEl=document.getElementById('sessionId');
    let typingEl=null;
    let firstMessage=true;
    function addMessage(type,text){
      if(firstMessage){chat.innerHTML='';firstMessage=false;}
      const messageDiv=document.createElement('div');
      messageDiv.className='message '+type;
      const avatar=document.createElement('div');
      avatar.className='avatar '+type;
      avatar.textContent=type==='user'?'V':'B';
      const content=document.createElement('div');
      content.className='message-content';
      content.textContent=text;
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(content);
      chat.appendChild(messageDiv);
      chat.scrollTop=chat.scrollHeight;
    }
    function showTyping(){
      if(typingEl)return;
      if(firstMessage){chat.innerHTML='';firstMessage=false;}
      const messageDiv=document.createElement('div');
      messageDiv.className='message ai';
      const avatar=document.createElement('div');
      avatar.className='avatar ai';
      avatar.textContent='B';
      const content=document.createElement('div');
      content.className='message-content';
      const typing=document.createElement('div');
      typing.className='typing';
      typing.innerHTML='<span></span><span></span><span></span>';
      content.appendChild(typing);
      messageDiv.appendChild(avatar);
      messageDiv.appendChild(content);
      chat.appendChild(messageDiv);
      typingEl=messageDiv;
      chat.scrollTop=chat.scrollHeight;
    }
    function hideTyping(){if(typingEl){typingEl.remove();typingEl=null;}}
    socket.on('welcome',({id})=>{sessionIdEl.textContent='Session: '+id;});
    socket.on('answer',({text})=>{hideTyping();addMessage('ai',text);});
    form.addEventListener('submit',e=>{
      e.preventDefault();
      const t=input.value.trim();
      if(!t)return;
      addMessage('user',t);
      input.value='';
      showTyping();
      socket.emit('ask',t);
    });
    input.addEventListener('input',function(){
      this.style.height='auto';
      this.style.height=this.scrollHeight+'px';
    });
  </script>
</body>
</html>
